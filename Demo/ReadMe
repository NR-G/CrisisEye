This is the server version of the code.
